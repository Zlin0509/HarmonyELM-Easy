# 数据库设置说明

## 方式一：使用MySQL数据库（推荐，完整功能）

### 步骤1：安装MySQL
如果还没有安装MySQL，请先安装：
- Windows: 下载 MySQL Installer from https://dev.mysql.com/downloads/installer/
- Mac: `brew install mysql` 或下载安装包
- Linux: `sudo apt-get install mysql-server` (Ubuntu/Debian)

### 步骤2：启动MySQL服务
确保MySQL服务正在运行：
- Windows: 在服务管理器中启动MySQL服务
- Mac/Linux: `sudo systemctl start mysql` 或 `brew services start mysql`

### 步骤3：创建数据库
打开MySQL命令行或MySQL Workbench，执行：

```sql
CREATE DATABASE eleme_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 步骤4：配置后端服务器
编辑 `backend/server.js` 文件，修改数据库配置：

```javascript
const dbConfig = {
  host: 'localhost',
  user: 'root',                    // 你的MySQL用户名
  password: 'your_password',       // 你的MySQL密码
  database: 'eleme_db',            // 刚创建的数据库名
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
};
```

### 步骤5：安装后端依赖并启动
```bash
cd backend
npm install
npm start
```

**注意**：后端服务器启动时会**自动创建所有需要的表**，你不需要手动创建表结构！

### 步骤6：配置前端API地址
编辑 `entry/src/main/ets/services/ApiService.ets`，修改 `BASE_URL`：

```typescript
// 如果后端在本地运行
const BASE_URL = 'http://localhost:3000/api';

// 如果是HarmonyOS模拟器访问本地服务器
const BASE_URL = 'http://10.0.2.2:3000/api';

// 如果是真机访问本地服务器（使用电脑的局域网IP）
const BASE_URL = 'http://192.168.1.100:3000/api';  // 替换为你的电脑IP
```

### 步骤7：取消注释API调用
在页面文件中取消注释真实的API调用：

**HomePage.ets** (第26-27行):
```typescript
// 取消注释这行
this.restaurants = await ApiService.getRestaurants();
// 注释掉模拟数据部分
```

**RestaurantDetailPage.ets** (第33行附近):
```typescript
// 取消注释这行
this.dishes = await ApiService.getDishesByRestaurant(this.restaurant.id);
// 注释掉模拟数据部分
```

---

## 方式二：不使用数据库（仅测试UI，使用模拟数据）

如果你只是想测试应用界面，**不需要创建数据库**！

### 当前状态
应用目前已经配置为使用**模拟数据**运行，你可以直接：

1. 在DevEco Studio中运行应用
2. 所有功能都会使用模拟数据
3. 不需要启动后端服务器
4. 不需要创建数据库

### 限制
- 数据不会保存到数据库
- 刷新后数据会重置
- 无法测试真实的API调用

---

## 快速测试流程

### 仅测试UI（最简单）
1. ✅ 直接运行HarmonyOS应用
2. ✅ 使用模拟数据查看界面效果
3. ❌ 不需要数据库
4. ❌ 不需要后端服务器

### 完整功能测试
1. ✅ 安装MySQL
2. ✅ 创建数据库 `eleme_db`
3. ✅ 配置 `backend/server.js` 中的数据库连接
4. ✅ 运行 `cd backend && npm install && npm start`
5. ✅ 配置前端 `ApiService.ets` 中的 `BASE_URL`
6. ✅ 取消注释页面中的API调用代码
7. ✅ 运行HarmonyOS应用

---

## 常见问题

### Q: 如何查看我的电脑IP地址？
**Windows:**
```cmd
ipconfig
```
查找 "IPv4 地址"

**Mac/Linux:**
```bash
ifconfig
```
或
```bash
ip addr show
```

### Q: 后端服务器启动失败？
1. 检查MySQL服务是否运行
2. 检查数据库配置是否正确
3. 检查端口3000是否被占用
4. 查看后端控制台的错误信息

### Q: 前端无法连接后端？
1. 检查后端服务器是否正在运行
2. 检查 `BASE_URL` 配置是否正确
3. 模拟器使用 `10.0.2.2`，真机使用电脑IP
4. 检查防火墙设置

### Q: 数据库表会自动创建吗？
是的！后端服务器启动时会自动执行 `initDatabase()` 函数，创建所有需要的表。

### Q: 需要手动插入数据吗？
不需要！后端服务器启动2秒后会自动插入示例数据（如果表是空的）。

---

## 总结

- **只想看界面**：直接运行应用，不需要数据库
- **需要完整功能**：先创建数据库，配置后端，然后运行

当前代码已经配置为使用模拟数据，你可以先运行看看效果，再决定是否需要设置数据库！
