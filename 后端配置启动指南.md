# 后端服务器配置和启动指南

## 📋 前置条件

1. ✅ 已安装 Node.js（建议 v14 或更高版本）
2. ✅ 已安装 MySQL 并创建了 `eleme_db` 数据库
3. ✅ 知道你的 MySQL 用户名和密码

---

## 🔧 步骤1：修改数据库配置

### 方法一：使用代码编辑器（推荐）

1. 打开项目文件夹
2. 找到 `backend/server.js` 文件
3. 用任意文本编辑器打开（VS Code、记事本、Sublime Text 等）
4. 找到第 17-26 行的数据库配置部分：

```javascript
// MySQL数据库配置
const dbConfig = {
  host: 'localhost',
  user: 'root',
  password: 'your_password', // 👈 修改这里为你的MySQL密码
  database: 'eleme_db',
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
};
```

5. **修改 `password` 字段**：
   - 如果你的 MySQL 密码是 `123456`，就改成：
     ```javascript
     password: '123456',
     ```
   - 如果你的 MySQL 密码是 `mypassword`，就改成：
     ```javascript
     password: 'mypassword',
     ```

6. **如果用户名不是 `root`**，也要修改 `user` 字段：
   ```javascript
   user: '你的用户名',
   ```

7. 保存文件（Ctrl+S 或 Cmd+S）

### 方法二：使用命令行（高级用户）

如果你熟悉命令行，可以使用以下命令：

**Windows (PowerShell):**
```powershell
# 使用记事本打开
notepad backend\server.js

# 或使用 VS Code（如果已安装）
code backend\server.js
```

**Mac/Linux:**
```bash
# 使用 nano 编辑器
nano backend/server.js

# 或使用 vim
vim backend/server.js

# 或使用 VS Code
code backend/server.js
```

---

## 📦 步骤2：打开终端/命令行

### Windows 用户：

1. **方法一：在项目文件夹中打开**
   - 在项目文件夹空白处，按住 `Shift` + 右键
   - 选择 "在此处打开 PowerShell 窗口" 或 "在此处打开命令窗口"

2. **方法二：使用命令提示符**
   - 按 `Win + R`，输入 `cmd`，回车
   - 使用 `cd` 命令进入项目目录：
     ```cmd
     cd C:\Users\27682\Desktop\DevEco\tmp
     ```

3. **方法三：在 VS Code 中**
   - 打开 VS Code
   - 按 `Ctrl + ~` 打开终端
   - 终端会自动在项目目录中

### Mac/Linux 用户：

1. 打开"终端"应用（Terminal）
2. 使用 `cd` 命令进入项目目录：
   ```bash
   cd ~/Desktop/DevEco/tmp
   # 或你的实际项目路径
   ```

---

## 📥 步骤3：安装依赖

在终端中执行以下命令：

```bash
cd backend
npm install
```

### 详细说明：

1. **`cd backend`** - 进入 backend 目录
   - 如果已经在项目根目录，执行这个命令
   - 如果已经在 backend 目录，可以跳过这一步

2. **`npm install`** - 安装所有依赖包
   - 这会下载并安装 `package.json` 中列出的所有依赖
   - 包括：express、mysql2、cors、body-parser 等
   - 可能需要几分钟时间

### 预期输出：

```
npm WARN eleme-backend@1.0.0 No description
npm WARN eleme-backend@1.0.0 No repository field.

added 100 packages in 30s
```

如果看到类似输出，说明安装成功！

### 常见问题：

**Q: 提示 "npm 不是内部或外部命令"？**
- 说明 Node.js 没有安装或没有添加到 PATH
- 解决：重新安装 Node.js，并确保勾选 "Add to PATH" 选项

**Q: 安装很慢？**
- 可以使用国内镜像加速：
  ```bash
  npm install --registry=https://registry.npmmirror.com
  ```

**Q: 出现权限错误？**
- Windows：以管理员身份运行命令提示符
- Mac/Linux：不要使用 `sudo`，如果必须使用，确保项目目录权限正确

---

## 🚀 步骤4：启动服务器

安装完成后，在终端中执行：

```bash
npm start
```

### 预期输出：

如果一切正常，你会看到：

```
服务器运行在 http://localhost:3000
数据库表初始化完成
示例数据插入完成
```

### 验证服务器是否运行：

1. **查看终端输出** - 应该看到 "服务器运行在 http://localhost:3000"
2. **打开浏览器** - 访问 `http://localhost:3000/api/restaurants`
   - 如果看到 JSON 数据或错误信息，说明服务器正在运行
   - 如果无法访问，检查防火墙设置

### 常见错误及解决方法：

#### ❌ 错误1：`Error: connect ECONNREFUSED 127.0.0.1:3306`
**原因**：MySQL 服务没有启动

**解决方法**：
- **Windows**：
  1. 按 `Win + R`，输入 `services.msc`
  2. 找到 "MySQL" 服务
  3. 右键 → 启动

- **Mac**：
  ```bash
  brew services start mysql
  ```

- **Linux**：
  ```bash
  sudo systemctl start mysql
  ```

#### ❌ 错误2：`Access denied for user 'root'@'localhost'`
**原因**：MySQL 用户名或密码错误

**解决方法**：
1. 检查 `server.js` 中的 `user` 和 `password` 是否正确
2. 如果忘记密码，可以重置 MySQL 密码

#### ❌ 错误3：`Unknown database 'eleme_db'`
**原因**：数据库还没有创建

**解决方法**：
1. 打开 MySQL 命令行或 MySQL Workbench
2. 执行：`CREATE DATABASE eleme_db;`
3. 重新启动服务器

#### ❌ 错误4：`Port 3000 is already in use`
**原因**：端口 3000 已被占用

**解决方法**：
1. 找到占用端口的程序并关闭
2. 或修改 `server.js` 中的端口号：
   ```javascript
   const PORT = 3001; // 改为其他端口
   ```

---

## ✅ 步骤5：验证服务器运行

### 方法1：使用浏览器测试

打开浏览器，访问以下 URL：

1. **测试商家列表接口**：
   ```
   http://localhost:3000/api/restaurants
   ```
   应该返回 JSON 格式的商家数据

2. **测试健康检查**（如果添加了）：
   ```
   http://localhost:3000/api/health
   ```

### 方法2：使用 curl 命令（Mac/Linux）

```bash
curl http://localhost:3000/api/restaurants
```

### 方法3：使用 PowerShell（Windows）

```powershell
Invoke-WebRequest -Uri http://localhost:3000/api/restaurants
```

---

## 🔄 开发模式（可选）

如果你在开发过程中需要自动重启服务器（修改代码后自动重启），可以使用：

```bash
npm run dev
```

**注意**：这需要先安装 `nodemon`：
```bash
npm install -g nodemon
```

---

## 📝 完整操作流程示例

```bash
# 1. 进入项目目录（如果不在）
cd C:\Users\27682\Desktop\DevEco\tmp

# 2. 进入 backend 目录
cd backend

# 3. 安装依赖（只需要执行一次）
npm install

# 4. 启动服务器
npm start

# 服务器运行后，终端会显示：
# 服务器运行在 http://localhost:3000
# 数据库表初始化完成
# 示例数据插入完成

# 5. 保持终端窗口打开，不要关闭
# 6. 现在可以在 HarmonyOS 应用中配置 API 地址了
```

---

## 🛑 停止服务器

在运行服务器的终端窗口中，按：
- **Ctrl + C** (Windows/Linux)
- **Cmd + C** (Mac)

---

## 📌 下一步

服务器启动成功后：

1. ✅ 配置前端 API 地址（`entry/src/main/ets/services/ApiService.ets`）
2. ✅ 取消注释页面中的 API 调用代码
3. ✅ 运行 HarmonyOS 应用测试

---

## 💡 提示

- **保持终端窗口打开**：关闭终端窗口会停止服务器
- **修改代码后**：需要重启服务器（Ctrl+C 停止，然后 `npm start` 重新启动）
- **查看日志**：服务器运行时的所有日志都会显示在终端中
- **数据库表**：服务器首次启动时会自动创建所有表，不需要手动创建

---

## 🆘 需要帮助？

如果遇到问题：
1. 检查终端中的错误信息
2. 确认 MySQL 服务正在运行
3. 确认数据库已创建
4. 确认数据库配置正确
5. 查看本文档的"常见错误"部分
